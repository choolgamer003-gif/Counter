<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Counter</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
  }
  #count {
    font-size: 40px;
    margin-bottom: 5px;
  }
  #legend {
    font-size: 16px;
    margin-bottom: 20px;
  }
  #icons {
    font-size: 32px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }
  .icon {
    display: inline-block;
  }
  #resetBtn {
    display: none; /* hidden by default */
  }
</style>
</head>
<body>

<div id="count">0</div>
<div id="legend">*Icons = 100,000 abortions*</div>
<div id="icons"></div>
<button id="resetBtn">Reset Counter</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
  import { getDatabase, ref, onValue, set, runTransaction, get } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

  // ---------- CONFIG ----------
  const firebaseConfig = {
    apiKey: "AIzaSyDeb7DFUNOX8PHCVqoQJ--rWy-yOxXf9KU",
    authDomain: "counter-f9760.firebaseapp.com",
    databaseURL: "https://counter-f9760-default-rtdb.firebaseio.com",
    projectId: "counter-f9760",
    storageBucket: "counter-f9760.appspot.com",
    messagingSenderId: "58667928978",
    appId: "1:58667928978:web:7a6b693dd373b2fbbf854b",
    measurementId: "G-GTG0KJT0LX"
  };

  // ---------- INITIALIZE ----------
  const app = initializeApp(firebaseConfig);
  const db = getDatabase();
  const totalRef = ref(db, "total");
  const START_TOTAL = 116576241; // starting number if missing

  const countEl = document.getElementById("count");
  const iconsEl = document.getElementById("icons");
  const resetBtn = document.getElementById("resetBtn");

  const decadeEmojis = [
    { start: 1970, emoji: 'ðŸ”´' },
    { start: 1980, emoji: 'ðŸŸ ' },
    { start: 1990, emoji: 'ðŸŸ¡' },
    { start: 2000, emoji: 'ðŸŸ¢' },
    { start: 2010, emoji: 'ðŸ”µ' },
    { start: 2020, emoji: 'ðŸŸ£' }
  ];

  // ---------- HELPER FUNCTIONS ----------
  function renderIcons(total) {
    iconsEl.innerHTML = "";
    let iconsCount = Math.floor(total / 100000);
    for (let i = 0; i < iconsCount; i++) {
      const decadeIndex = Math.floor(i / 10) % decadeEmojis.length;
      const icon = document.createElement("span");
      icon.className = "icon";
      icon.textContent = decadeEmojis[decadeIndex].emoji;
      iconsEl.appendChild(icon);
    }
  }

  function incrementTotal() {
    runTransaction(totalRef, current => (typeof current === "number" ? current + 1 : START_TOTAL));
  }

  function ensureTotalExists() {
    get(totalRef).then(snapshot => {
      if (!snapshot.exists()) {
        set(totalRef, START_TOTAL);
      }
    });
  }

  // ---------- LISTEN TO DB ----------
  onValue(totalRef, snapshot => {
    const total = snapshot.val() || START_TOTAL;
    countEl.textContent = total.toLocaleString();
    renderIcons(total);
  });

  // ---------- INIT ----------
  ensureTotalExists();

  // ---------- AUTO INCREMENT ----------
  function randomIntervalIncrement() {
    const interval = 10000 + Math.random() * 20000; // 10â€“30 seconds
    setTimeout(() => {
      incrementTotal();
      randomIntervalIncrement();
    }, interval);
  }
  randomIntervalIncrement();

  // ---------- RESET BUTTON ----------
  resetBtn.addEventListener("click", () => {
    set(totalRef, START_TOTAL);
  });

</script>

</body>
</html>
